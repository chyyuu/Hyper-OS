## Hyper-OS 

Hyper-OS 的核心思想是使用线程和线程间的同步模拟处理器控制流和异常控制流，在这个模拟的硬件环境下完成一个足够简单和抽象的操作系统，从而达到揭示操作系统基本功能和原理的目的。

在Hyper-OS中，每个硬件运行在单独的线程上，每个正在运行的用户进程运行在一个线程上，每个处于等待状态的用户进程运行在一个线程上，但等在所在线程的条件变量`cond_var`上。

## 硬件

Hyper-OS 的使用一个线程模拟一个逻辑上的硬件，例如物理内存、键盘、时钟等。这种线程称为硬件线程。硬件线程在初始化时被创建出来，并持续工作，利用“总线”、“中断”等方式与“处理器”协同工作。

## 进程和处理器

我们称Hyper-OS中提供的进程为用户进程。Hyper-OS不模拟处理器，而是将处理器看作某种”资源“。用户进程在运行时获取这个资源，并通过同步互斥机制，保证任何时候只有一个进程拥有某个处理器。

具体而言，每个处理器拥有一个互斥锁`cpu_mutex`，逻辑上运行在某个处理器的用户进程拥有这个锁。当其由于某种原因（例如被中断打断需要进入内核态）需要放弃处理器时，它放弃这个锁。

操作系统通过`create_process`创建一个逻辑进程，使用`exec_process`将某个应用程序加载到内存中执行。

## 中断

中断是硬件提供的打断当前控制流并进入对应中断处理例程的机制。在Hyper-OS中，中断信号的分发和处理是由APIC和LPIC实现的。

TODO

用户进程通过在访存语句的末尾检查中断标记确定中断的发生。当检测到中断发生时，用于进程放弃CPU访问权，中断处理例程接管CPU并响应中断。

## 页机制

Hyper-OS默认使用页机制管理内存。MMU通过页表查询虚拟地址对应的物理地址，并完成地址翻译。操作系统在每个进程创建时（`create_process`）建立其页表，并完成初始化工作。

当MMU发现页错误时，它会向所在的CPU发送一个页错误中断。

## 应用程序

Hyper-OS使用一种简单的应用程序结构。

每一个应用程序是继承自抽象类`program`的一个类，实现两个函数：
